const isDev = () => process.env.NODE_ENV === 'development';

module.exports = {
    parser: '@typescript-eslint/parser',
    extends: [
        'next/core-web-vitals',
        'plugin:@next/next/recommended',
        'plugin:react/recommended',
        'plugin:@typescript-eslint/recommended',
        'plugin:jsx-a11y/recommended',
        'plugin:import/recommended',
        'plugin:import/typescript',
        'prettier',
    ],
    plugins: ['unused-imports', 'react-hooks', 'jsx-a11y', 'import'],
    parserOptions: {
        ecmaVersion: 2018,
        sourceType: 'module',
        ecmaFeatures: {
            jsx: true,
        },
    },
    settings: {
        react: {
            version: 'detect',
        },
        'import/parsers': {
            '@typescript-eslint/parser': ['.ts', '.tsx', '.js'],
        },
        'import/resolver': {
            typescript: {
                project: __dirname,
            },
        },
    },
    overrides: [
        {
            files: ['*.graphql'],
            parser: '@graphql-eslint/eslint-plugin',
            plugins: ['@graphql-eslint'],
            parserOptions: {
                schema: './schema.graphql',
            },
            rules: {
                '@graphql-eslint/no-duplicate-fields': 'error',
                '@graphql-eslint/no-anonymous-operations': 'error',
                '@graphql-eslint/unique-input-field-names': 'error',
                '@graphql-eslint/unique-variable-names': 'error',
                '@graphql-eslint/no-deprecated': 'warn',
            },
        },
    ],
    rules: {
        'import/no-cycle': isDev() ? 'warn' : 'off',
        'import/no-named-as-default-member': 'off',
        'import/no-named-as-default': 'off',
        // Types generated by apollo are not camelcase
        '@typescript-eslint/camelcase': 'off',
        // Better make a derivable function
        '@typescript-eslint/explicit-function-return-type': 'off',
        // server is using commonjs
        '@typescript-eslint/no-var-requires': 'off',
        '@typescript-eslint/no-empty-interface': 'off',
        '@typescript-eslint/no-empty-function': 'off',
        '@typescript-eslint/interface-name-prefix': 'off',
        // We don't use prop-types
        'react/prop-types': 'off',
        'react/display-name': 'off',
        'react-hooks/rules-of-hooks': 'error',
        'react-hooks/exhaustive-deps': [
            'error',
            {
                additionalHooks: `(${[
                    'useMemoized',
                    'useUpdateEffect',
                    'useIsomorphicLayoutEffect',
                    'useDeepCompareEffect',
                    'useShallowCompareEffect',
                    'useCustomCompareEffect',
                ].join('|')})`,
            },
        ],
        'unused-imports/no-unused-imports': 'error',
        //JSX-ally disabled rules
        //For details check docs/best-practices/0008-a11y-checks-in-storybook-and-eslint.md
        'jsx-a11y/no-noninteractive-element-interactions': 'off',
        'jsx-a11y/no-onchange': 'off',
        'jsx-a11y/anchor-is-valid': 'off',
        '@typescript-eslint/explicit-module-boundary-types': 'off',
        '@typescript-eslint/ban-ts-comment': 'off',
        '@typescript-eslint/no-unused-vars': [
            'error',
            {
                ignoreRestSiblings: true,
            },
        ],
        'no-restricted-imports': [
            'error',
            {
                paths: [
                    {
                        name: 'react-use',
                        importNames: ['useIntersection'],
                        message:
                            'Please use patched useIntersection from @trivago/hooks, react-use lib has an issue with the stale state https://github.com/streamich/react-use/issues/2376.',
                    },
                ],
            },
        ],
        'lodash/import-scope': 'error',
        // we have our custom implementation for that. If needed, we can revisit it later
        '@next/next/next-script-for-ga': 'off',
        // This rule will be applied in https://tasks.trivago.com/browse/WEB-63025
        '@next/next/no-img-element': 'off',
        curly: 'error',
        'react/jsx-boolean-value': 'error',
        'react/self-closing-comp': 'error',
        'react/jsx-curly-brace-presence': 'error',
    },
};
